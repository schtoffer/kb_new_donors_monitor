{% extends "layout.html" %}

{% block title %}Kart - Faste Givere{% endblock %}

{% block additional_styles %}
<style>
    .map-container {
        width: 100%;
        height: 400px;
        margin: 20px 0;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .stats-container {
        margin: 20px 0;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .stats-card {
        background-color: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .stats-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--primary-color);
    }
    
    .stats-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .stats-table th, .stats-table td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }
    
    .stats-table th {
        font-weight: 600;
        color: #555;
    }
    
    .bar-chart {
        margin-top: 20px;
    }
    
    .bar-container {
        height: 25px;
        margin: 8px 0;
        display: flex;
        align-items: center;
    }
    
    .bar-label {
        width: 100px;
        font-size: 14px;
    }
    
    .bar {
        height: 100%;
        background-color: var(--primary-color);
        border-radius: 4px;
        transition: width 0.5s ease;
    }
    
    .bar-value {
        margin-left: 10px;
        font-size: 14px;
        font-weight: 600;
    }
    
    .folium-map {
        width: 100%;
        height: 100%;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1>Geografisk fordeling av faste givere</h1>
    
    <div class="map-container">
        {{ map_html|safe }}
    </div>
    
    <div class="stats-container">
        <div class="stats-card">
            <div class="stats-title">Topp 5 fylker</div>
            <div class="bar-chart">
                {% for fylke, count in top_fylker %}
                <div class="bar-container">
                    <div class="bar-label">{{ fylke }}</div>
                    <div class="bar" style="width: {{ (count / top_fylker[0][1] * 200)|int }}px;"></div>
                    <div class="bar-value">{{ count }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="stats-card">
            <div class="stats-title">Alle fylker</div>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Fylke</th>
                        <th>Antall givere</th>
                        <th>Prosentandel</th>
                    </tr>
                </thead>
                <tbody>
                    {% set total = namespace(value=0) %}
                    {% for fylke, count in fylke_data %}
                        {% set total.value = total.value + count %}
                    {% endfor %}
                    
                    {% for fylke, count in fylke_data %}
                    <tr>
                        <td>{{ fylke }}</td>
                        <td>{{ count }}</td>
                        <td>{{ ((count / total.value) * 100)|round(1) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add any additional JavaScript for the map page here
    });
</script>
{% endblock %}
